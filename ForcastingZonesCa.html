<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>CodePen - Cute skeuomorphic checkboxes </title>
  <!-- <link rel="stylesheet" href="./assests/css/style.css"> -->
  <meta charset="utf-8">

      <title>CA Electric Demand Planning Areas and Forecasting Zones - Du Pham</title>
  
  
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  
   <style>
      * {
          font-family: 'Roboto', sans-serif;
          text-transform: capitalize;
          margin: 0 auto;
          text-align: center;
      } 
  
      body {
          font-family: "Roboto" !important;
          width: 100%;
          height: 100px;
          position: relative;
          background-color: rgb(255, 255, 255); 
      }
  
      h1 {
              font-size:40px;
              background: -webkit-linear-gradient(270deg,#002d51, rgb(119, 194, 251)); //,#5e0000, rgb(255, 0, 0)
              background-clip: text;
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              text-shadow: 2px 2px 45px #015284;
              }
  
      #labels{ text-shadow: 2px 2px 8px #013d6f;
              pointer-events: none;}
      
      .tooltip{text-shadow: 2px 2px 25px #015284;}
      
  </style>
</head>
<body>
<!-- partial:index.partial.html -->

<!-- partial -->
<h1>CA Electric Demand Planning Areas and Forcasting Zones</h1>
<div class="container">
    <input type="checkbox" id="checkbox" value="PGE" checked style="accent-color: #91dfe8;"/> <label> <i class="fa fa-lightbulb-o" style="font-size:30px;color: #91dfe8;"></i> PGE  </label>   
    <input type="checkbox" id="checkbox" value="SCE" checked style="accent-color: #56c4dc;"/>  <label> <i class="fa fa-lightbulb-o" style="font-size:30px;color: #56c4dc;"></i> SCE </label>
    <input type="checkbox" id="checkbox" value="SDGE" checked style="accent-color: #2397b1;"/> <label><i class="fa fa-lightbulb-o" style="font-size:30px;color: #2397b1;"></i> SDGE </label>
    <input type="checkbox" id="checkbox" value="VEA" checked style="accent-color: #025e85;"/> <label> <i class="fa fa-lightbulb-o" style="font-size:30px;color:  #025e85;"></i> VEA</label>
    <input type="checkbox" id="checkbox" value="IID" checked style="accent-color: #ffa0a0;"/> <label> <i class="fa fa-lightbulb-o" style="font-size:30px;color: #ffa0a0;"></i> IID</label>
    <input type="checkbox" id="checkbox" value="NCNC" checked style="accent-color: #dc5656;"/> <label> <i class="fa fa-lightbulb-o" style="font-size:30px;color: #dc5656;"></i> NCNC</label>
    <input type="checkbox" id="checkbox" value="LADWP" checked style="accent-color: #b12323;"/> <label> <i class="fa fa-lightbulb-o" style="font-size:30px;color: #b12323;"></i> LADWP</label>
    <input type="checkbox" id="checkbox" value="BUGL" checked style="accent-color: #850202;"/> <label> <i class="fa fa-lightbulb-o" style="font-size:30px;color: #850202;"></i> BUGL</label>
</div>

<!-- Create an element where the map will take place -->
<div id="chart"></div>
<script>

    // The svg
    var
        margin = { top: 5, right: 20, bottom: 10, left: 10 }
        , width = window.innerWidth
        , height = window.innerHeight - margin.top - margin.bottom 
        , colorScale = ['#025e85',  '#2397b1','#56c4dc',  '#a0f5ff','#850202', '#b12323','#dc5656','#ffa0a0','#dbdbdb'] 
        , svg = d3.select('#chart').append("svg").attr("width", width)
            .attr("height",   height)
            .attr('viewBox', (- width / 2) + ' ' + (-height / 2) + ' ' + width + ' ' + height)
            .attr('preserveAspectRatio', 'xMinYMin')
        ; 
    
    var projection = d3.geoMercator()
        .center([-119, 37.4])
        .scale((1 << 18) / 60)
        .translate([margin.left,-30]);
    var path = d3.geoPath().projection(projection);

    Promise.all([
        d3.json('./assets/dat/CA-06-california-counties.geojson'),
        d3.json('./assets/dat/California_Electricity_Demand_Forecast_Zones_CAISO.geojson')
    ]).then(function([counties,data]){
        draw_FZ(data);
        draw_counties(counties);
        
        
    })
    
    const duration = 100;
    
    function draw_counties(counties){
     svg.append("g")
        .selectAll("path")
        .data(counties.features)
        .enter().append("path")
            .attr("d", path)
            .attr("fill", "none")
            .attr("stroke", "black")
            .attr("stroke-width", .1 )
            // .attr("opacity", .5)
            .attr("class", "county");
    svg.append("g")
        .attr("id", "labels")
        .selectAll("text")
        .data(counties.features)                       
        .join('text')                                     
        .attr('text-anchor', 'middle')                  
        .text(d => d.properties.NAME)
        .style("font-size", 'xx-small')
        .attr('x', d => path.centroid(d)[0])
        .attr('y', d => path.centroid(d)[1]);
        
    }    

    
    function draw_FZ( topo) {
 
    svg.append("g")
        .selectAll("path")
        .data(topo.features)
        .join("path")
            .attr("fill", d => colorScale[d.properties.Plnng_Area_Num])
            .attr("d", path)
            .attr("class", "FZ")
            .attr("id", d => d.properties.Plnng_Area);

    
    svg.append("path")
        .datum(topo.features)
        .attr("fill", "none")
        .attr("stroke", "white")
        .attr("stroke-linejoin", "round")
        .attr("d", path);
 

    const tooltip = svg.append("g").attr("class", "tooltip");
    
    svg
        .selectAll(".FZ")
        .on("mouseover", function(d) {
        tooltip.call(
            callout, 
            `PA:${d.srcElement.__data__.properties.Plnng_Area} - FZ:${d.srcElement.__data__.properties.FZ_Name}
${d.srcElement.__data__.properties.FZ_Def}`
        );
        d3.select(this)
            .attr("stroke", "black")
            .raise();
        })
        .on("mousemove", function(d) {
        tooltip.attr(
            "transform",
            `translate(${d3.pointer(d)[0]},${d3.pointer(d)[1]})`
        );
        })
        .on("mouseout", function() {
        tooltip.call(callout, null);
        d3.select(this)
            .attr("stroke", null)
            .lower();
        }).on("click", reset);
    
        callout = (g, value) => {
            if (value === null) {return g.attr("display", "none");} 
            else{
            g
                .attr("display", null)
                .attr("pointer-events", "none")

            const path = g.selectAll("path")
                .data([null])
                .join('path').attr("id", "tooltips")
                .attr("fill", "white")
                .style("fill-opacity", .3);


            const text = g.selectAll("text")
                .data([null])
                .join("text").attr("id", "tooltips")
                .call(text => text
                    .selectAll("tspan")
                    .data((value + "").split(/\n/))
                    .join("tspan")
                        .attr("x", 0)
                        .attr("y", (d, i) => `${i * 1.1}em`)
                        .style("font-weight", (_, i) => i ? null : "bold")
                        .style("font-size", (_, i) => i ? "x-small" : null)
                        .attr("text-anchor", "right")
                        .text(d => d.length > 130 ? d.substring(0, 130) + " ..." : d)
                    );
            const {x, y, width: w, height: h} = text.node().getBBox();
           
            text.attr("transform", `translate(${-w / 2},${15 - y})`);
            path.attr("d", `M${-w / 2 - 10},5H-5l5,-5l5,5H${w / 2 + 10}v${h + 20}h-${w + 20}z`);
            }
        }
        
        zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on('zoom', function(event) { 
            svg.selectAll('path.FZ')
                .attr("stroke-width", 2 / (event.transform.k/2+1))
                .attr('transform', event.transform);
                
            svg.selectAll('path.county')
                .attr("stroke-width", .1 / (event.transform.k/2+1))
                .attr('transform', event.transform);
                
            svg.selectAll('#labels')
                .attr('transform', event.transform);
   
         });  

        svg.call(zoom);

        function reset() {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity,
                d3.zoomTransform(svg.node()).invert([width / 2, height / 2])
            );
        }
    
    function update(){
        
        // For each check box:
        d3.selectAll("#checkbox").each(function(d){ console.log(d);
          cb = d3.select(this);
          pa = cb.property("value")
  
          // If the box is check, I show the group
          if(cb.property("checked")){
            svg.selectAll("#"+pa).transition().duration(duration).style("opacity", 1);
  
          // Otherwise I hide it
          }else{
            svg.selectAll("#"+pa).transition().duration(duration).style("opacity", 0);
          }
        })
      }
  
      // When a button change, I run the update function
    d3.selectAll("#checkbox").on("change",update);
  
      // And I initialize it at the beginning
    update()

    }

    </script>

</body>
</html>